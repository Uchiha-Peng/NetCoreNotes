## 关于MVC

在学习MVC之前，我们必须意识到它用于开发图形用户界面（GUI）应用程序。这意味着，基于MVC的应用程序必须具有图形用户界面，而不是命令行界面。Web应用程序，移动应用程序和桌面应用程序都是GUI应用程序。虽然Web服务，基于控制台和类库不是。

如果应用程序没有图形用户界面，则无法将MVC的概念应用于它，因为**View**近似于图形用户界面部分。

请注意，这里我们使用*近似*词，因为有时视图是用户界面，有时它们不是。当你完成课程时，你会明白为什么。

#### MVC是一种模式

在讨论软件开发时，**模式**是常规角色的组合。在一种模式中，每个角色都有自己的职责并与其他角色进行交互。

软件旨在处理数据。经过长时间观察，人们发现GUI应用程序的数据处理周期由以下三个步骤组成：

- 应用程序通过用户界面向用户显示数据
- 用户通过操作用户界面来更改数据并表达意图
- 应用程序（及其逻辑）处理数据并响应用户

这个过程涉及多少个角色？答案是三个。它们是**数据**，**用户界面**和**逻辑**。用户怎么样？为什么用户不是角色？由于用户不是应用程序的一部分，因此不能成为一个角色。

我们可以在下表中总结角色及其关系：

| 角色     | 责任                                                 |
| -------- | ---------------------------------------------------- |
| 数据     | 携带显示给用户的信息或从用户收集的信息               |
| 用户界面 | 显示数据，收集数据，将操作传递给逻辑                 |
| 逻辑     | 处理数据，响应用户操作，选择适当的用户界面来显示数据 |

在漫长的进化历史中，基于他们的职责，数据，用户界面和逻辑的角色已经将其名称更改为**模型**，**视图**和**控制器**，这更适合和适用。因此，我们可以将表重绘为：

| 角色   | 责任                                                 |
| ------ | ---------------------------------------------------- |
| 模型   | 携带显示给用户的信息或从用户收集的信息               |
| 视图   | 显示数据，收集数据，将操作传递给逻辑                 |
| 控制器 | 处理数据，响应用户操作，选择适当的用户界面来显示数据 |

在这个新表中，我们将以下两个职责分配给控制器：

- 响应用户操作。例如，在用户单击订单页面上的“更新”按钮后，控制器应该知道如何更新用户选择的订单。
- 选择适当的视图以显示模型。例如，如果存在订单信息记录，则控制器应选择适当的视图以显示记录。

既然您已经了解了MVC模式的角色，那么让我们来看看角色如何相互作用。以下是MVC模式中角色之间交互的一些限制。当您编写自己的MVC程序时，尽量不要破坏这些规则。如果您不小心破坏了这些限制，您的MVC模式可能会转换为MVC模式的某些变体，我们将在后面讨论。

1. 控制器：

- 控制器响应用户的命令
- 控制器操纵模型
- Controller为模型选择适当的视图或为视图选择合适的模型
- 控制器可以要求视图显示模型

1. 视图：

- View将用户的命令/操作传递给控制器
- 视图可能知道也可能不知道其模型的类型
- 在控制器分配一个实例之前，View将不知道其模型实例（实际视图模型）
- View知道如何在控制器要求时渲染模型
- View不会直接操纵其模型，只有控制器才能操作模型

1. 模型：

- 模型可以具有业务逻辑，例如将数据持久保存到数据库
- 模型将由控制器操纵并由视图呈现
- 模型不会主动与控制器交互，这意味着模型不能操纵控制器
- 模型不会主动与视图交互，这意味着模型无法操纵视图

#### MVC模式有多个变种

我们已经涵盖了MVC模式中的多个角色，多个职责以及角色之间的关系，并指出它们是由其职责决定的。如果我们更改限制并合法地重新分配职责，我们将获得一些MVC模式的变体。例如，Mode-View-Presenter（MVP）模式和Model-View-ViewModel（MVVM）模式。

由于MVVM也是一种流行的模式，让我们仔细看看它。MVVM模式的简单想法是打破视图和模型之间的隔阂：

1. 视图知道其模型并可以直接操作模型
2. 视图的模型（视图模型）直接响应用户操作
3. 视图的模型（视图模型）可以主动通知视图如何渲染它（模型）
4. 控制器的职责被重新分配给查看模型

因为控制器可以完全从精心设计的模型增强模式中消失，所以MVC的名称应该更改为MV。但MV的名称太短，含糊不清，并没有突出增强的视图模型，因此名称Model-View-ViewModel（MVVM）诞生了。

#### 使用MVC模式的好处

GUI应用程序是事件驱动的。对于GUI应用程序，无论是Web应用程序，移动应用程序还是桌面应用程序，我们发现我们实际上可以将其所有逻辑放在事件处理程序方法中。

例如，在按钮事件处理程序方法中，我们可以在文本框中验证文本，从下拉列表中的选定项中提取值，检查是否选中了复选框，然后与本地文件系统，数据库或Web服务进行通信保持数据。我们将此方法称为快速应用程序开发（RAD）。

RAD适用于小型应用程序，但是当应用程序越来越大时，UI实例之间的关系开始变得混乱。特别是当多个开发人员正在为同一组UI编写代码时，尝试理解来自其他开发人员的逻辑开始变得越来越难。维护代码，解决代码冲突和修复错误的成本上升。

为了避免这些问题，我们可以做两件事：

1. 将数据和逻辑与事件处理程序分开，并将它们集中在某处，以便最大化代码重用
2. 对于集中式数据和逻辑，将它们分成不同的角色和职责

经过数十年的实验和抛光过程，软件行业发现MVC（及其变体）始终是一个良好而稳定的解决方案。它可以有效地消除大规模RAD引起的问题。在大型GUI项目中应用MVC模式的好处包括：

1. 强大：开发人员只能在正确的位置编写代码。他们可以轻松地理解和重用其他人的代码。
2. 可测试：UI很难测试，但与UI分离的模型和控制器很容易使用单元测试用例进行测试。这大大提高了软件质量和开发性能。
3. 可扩展：对于RAD开发，添加的UI元素越多，UI形成的网络就越复杂。但MVC将应用程序的功能划分为小的垂直支柱。每个支柱由一组控制器，视图和模型组成。为了扩展应用程序的功能，我们不断添加小支柱并按单元测试用例覆盖代码。

#### MVC模式的实现


在现实生活中，使用MVC及其变体有三种方法：

1. **RAD + MVC模式**：例如，Windows Forms是Windows的普通RAD框架，在编写Windows Forms程序时，您可以创建模型，视图和控制器，而不是将所有代码放在事件处理程序中，以享受MVC模式

2. **RAD + MVC框架**：为了避免重新发明轮子，开发人员为那些普通的RAD框架创建了许多可重用的MVC框架。例如，Windows Presentation Foundation（WPF）是用于Windows的普通RAD框架，PRISM是一个包含基类并实现MVVM模式的基本基础结构的框架。使用PRISM框架时，您可以通过派生基类轻松创建视图，模型和视图模型，而无需从头开始构建它们。

   另一个例子是Angular框架。HTML + JavaScript是传统的Web客户端RAD框架; 使用纯HTML + JavaScript创建企业级Web应用程序很困难。Angular是用于HTML Web客户端开发的MVC框架。一旦您将HTML和Angular框架结合使用，您的Web应用程序就会成为MVC应用程序。

3. **MVC应用程序框架**：有许多MVC应用程序框架，例如ASP.NET MVC，ASP.NET Core和Spring MVC。使用MVC应用程序框架和使用RAD + MVC框架之间的区别在于，一旦在MVC应用程序框架上构建应用程序，应用程序就会被自然地限制为MVC应用程序，并且您没有机会使其成为非MVC。

   例如，当您使用ASP.NET MVC，ASP.NET Core或Spring MVC创建Web应用程序时，项目脚手架将准备应用程序体系结构，为您应用MVC模式。您的工作就是不断添加模型，视图和控制器以实现客户的要求。

简而言之，对于每个现代开发人员来说，MVC模式（及其变体）的知识几乎是必需的。